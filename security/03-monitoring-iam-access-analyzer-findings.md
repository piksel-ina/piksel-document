# Monitoring IAM Access Analyzer Findings

|             |                           |
| ----------- | ------------------------- |
| **Version** | 1.0                       |
| **Date**    | 2025-05-02                |
| **Owner**   | Cloud Infrastructure Team |

## 1. Overview

This document outlines the process for monitoring and managing findings generated by AWS IAM Access Analyzer within the Piksel project environments (dev, staging, prod). IAM Access Analyzer continuously monitors resource-based policies (e.g., S3 bucket policies, IAM role trust policies, KMS key policies) to identify resources shared with external principals (principals outside the AWS account).

Monitoring these findings is a crucial proactive security measure to detect and remediate potentially unintended or overly permissive access to our resources.

The IAM Access Analyzer itself is provisioned via Terraform as part of the core infrastructure setup for each environment (see `main.tf` in the relevant infrastructure repository). This document focuses on the _operational workflow_ after the analyzer is active.

## 2. Accessing Findings

Findings are reviewed directly within the AWS Management Console for each specific environment/account.

1.  Log in to the appropriate AWS Account (Dev, Staging, or Prod).
2.  Navigate to the **IAM** service.
3.  In the left-hand navigation pane, under **Access reports**, click on **Access Analyzer**.
4.  Ensure you are viewing the correct Analyzer. The name should correspond to the environment, typically `${project}-${environment}-analyzer` (e.g., `piksel-dev-analyzer`).
5.  The main pane will display **Active findings**. Findings represent resources shared with an external principal.

## 3. Understanding Findings

Each finding provides details about the shared resource and the external access:

- **Resource:** The specific AWS resource (e.g., S3 bucket ARN, IAM role ARN) that has a policy granting external access.
- **Resource Owner Account:** The AWS account ID where the resource resides (should be the current account).
- **Principal:** The external principal granted access. This could be:
  - Another AWS Account ID.
  - All principals (`*`).
  - A specific IAM user/role ARN from another account.
  - An AWS service principal (less common for _external_ findings unless misconfigured).
  - Anonymous users (for public S3 buckets).
- **Action:** The action(s) granted by the policy statement causing the finding.
- **Condition:** Any conditions specified in the policy statement that affect the access.
- **Finding Type:** Indicates the type of external access (e.g., Cross-account, Public).
- **Status:** `Active`, `Archived`, or `Resolved`. We primarily focus on `Active` findings.

## 4. Review Workflow

New `Active` findings should be reviewed regularly. The goal is to determine if the granted external access is **intended and approved** or **unintended and requires remediation**.

1.  **Identify New Findings:** Regularly check the Access Analyzer console for new `Active` findings.
2.  **Investigate:**
    - Click on a finding to view its details.
    - Understand _which_ resource is shared (`Resource`).
    - Understand _who_ it is shared with (`Principal`).
    - Understand _what_ permissions are granted (`Action`, `Condition`).
    - Determine the _purpose_ of this access. Why was this policy created? Consult documentation, commit history (if managed by IaC), or the team responsible for the resource.
3.  **Validate:**
    - **Is this access expected and necessary?** (e.g., granting read access to a specific partner account's role for a shared S3 bucket, CloudFront OAI/OAC access to a web bucket).
    - **Is the access scoped correctly?** Does it follow the principle of least privilege? (e.g., Is `s3:*` granted when only `s3:GetObject` is needed? Is it shared with `*` when only a specific account needs access?).
4.  **Take Action:**
    - **If Unintended/Incorrect:** Proceed to **Remediation (Section 5)**.
    - **If Intended/Approved:** Proceed to **Archiving (Section 6)**.

## 5. Remediation

If a finding represents unintended, overly permissive, or incorrect access, the underlying resource policy must be modified.

1.  **Identify the Policy:** Locate the policy attached to the resource identified in the finding (e.g., S3 bucket policy, IAM role trust policy). If managed by Terraform, locate the relevant `aws_iam_policy_document` data source or resource block.
2.  **Modify the Policy:** Adjust the policy statement(s) to remove or restrict the unintended access. This might involve:
    - Removing the external principal.
    - Changing the principal to a more specific one.
    - Reducing the scope of allowed actions.
    - Adding or tightening conditions.
3.  **Deploy Changes:** Apply the changes (e.g., via `terraform apply` if managed by IaC, or directly in the console for manually managed resources - though IaC is preferred).
4.  **Verify:** After the changes are deployed, return to Access Analyzer. The finding should automatically transition to `Resolved` status after Access Analyzer rescans the resource (this may take some time, up to 30 minutes usually).

## 6. Archiving Findings

If a finding represents **intended, reviewed, and approved** external access, it should be archived. Archiving tells Access Analyzer that you accept this specific access configuration.

1.  **Select Finding(s):** In the Access Analyzer console, select the checkbox next to the `Active` finding(s) you have validated as acceptable.
2.  **Archive:** Click the **Archive** button.
3.  **Confirmation:** Confirm the action.

Archived findings will move to the `Archived` tab. Access Analyzer will _not_ flag this specific resource/principal combination again _unless the policy statement changes_. If the policy is modified, a new finding might be generated.

**Note:** While archive rules can be managed via Terraform (`aws_accessanalyzer_archive_rule`), the current workflow relies on manual archiving via the console after review. This allows for explicit confirmation of expected access patterns.

## 7. Review Cadence

- **Frequency:** Active findings in IAM Access Analyzer should be reviewed regularly. A recommended starting cadence is **weekly** or **bi-weekly**.
- **Responsibility:** The Cloud Engineering / Security team is responsible for performing these reviews.
- **Environments:** Reviews must be conducted independently for **Dev, Staging, and Prod** environments.

## 8. Scope and Limitations

- The current setup uses **Account-level** analyzers. They only analyze resources within their respective AWS accounts.
- Findings are based on resource policy analysis. They do not analyze identity-based policies or network configurations (Security Groups, NACLs).

## 9. Future Considerations

- **Automated Notifications:** Configure EventBridge rules to send notifications (e.g., to Slack or email via SNS) when new _Active_ findings are generated by Access Analyzer.
- **Terraform-Managed Archive Rules:** For stable, well-understood external access patterns, consider defining `aws_accessanalyzer_archive_rule` resources in Terraform.
- **Organization Analyzer:** If managing many accounts, consider setting up a central Organization-level analyzer via a delegated administrator account for unified cross-account visibility.

## 10. Related Documents

- [IaC README](../../piksel-infrastructure/README.md) (Link to the actual infrastructure repo README)
- [IAM Strategy](./iam-strategy.md)
